_version: 1.0.x
_class: open_ticket_ai.hf_local.HFLocalTextClassificationPipe
_extends: open_ticket_ai.core.pipeline.ConfigurablePipe

_title: HuggingFace Local Text Classification
_summary: Performs text classification using a local HuggingFace model.
_category: ai-classification

_inputs:
  placement: flat
  alongside: [id, use]
  params:
    model: HuggingFace model name/path for text classification
    token: Optional HuggingFace token for private models
    prompt: Text to classify
_defaults:
  token: null

_output:
  state_enum: [ok, failed]
  description: Pipe returns classification results with label and confidence.
  payload_schema_ref: OpenTicketAI.Pipes.HFLocalTextClassification.Result
  examples:
    ok:
      state: ok
      payload:
        label: "POSITIVE"
        confidence: 0.9234
    failed:
      state: failed
      error: model_load_failed

_errors:
  fail:
    - code: model_load_failed
      when: Cannot load or initialize the specified model
    - code: model_not_found
      when: Specified model does not exist
    - code: classification_failed
      when: Model classification process failed
    - code: invalid_token
      when: HuggingFace token is invalid for private model access
  break:
    - code: config_invalid
      when: Required config parameters missing or invalid
    - code: insufficient_memory
      when: Not enough memory to load the model
  continue:
    - code: empty_prompt
      when: Prompt is empty â†’ pipe returns skipped

_engine_support:
  on_failure: false
  on_success: false

_examples:
  minimal: |
    - id: classify_text
      use: open_ticket_ai.hf_local.HFLocalTextClassificationPipe
      model: "distilbert-base-uncased-finetuned-sst-2-english"
      prompt: "{{ context.ticket.subject }}"

  full: |
    - id: sentiment_analysis
      use: open_ticket_ai.hf_local.HFLocalTextClassificationPipe
      model: "cardiffnlp/twitter-roberta-base-sentiment-latest"
      token: "{{ env.HUGGINGFACE_TOKEN }}"
      prompt: "{{ context.ticket.subject }} {{ context.ticket.body }}"

  large: |
    - id: priority_classification
      use: open_ticket_ai.hf_local.HFLocalTextClassificationPipe
      model: "softoft/ticket-priority-classifier-v2"
      token: "{{ env.HUGGINGFACE_TOKEN }}"
      prompt: |
        Subject: {{ context.ticket.subject }}
        Description: {{ context.ticket.body }}
        Customer: {{ context.ticket.customer.name }}
        Product: {{ context.ticket.product.name }}