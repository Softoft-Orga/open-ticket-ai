---
title: "Notiz hinzuf\xFCgen"
description: "F\xFCgt einem Ticket eine Notiz/Artikel hinzu."
---

<!-- Generated by python_extras.scripts.doc_generation.generate_pipe_docs -->

# Notiz hinzufügen

- **Python class:** `open_ticket_ai.basic_pipes.ticket_system_pipes.AddNotePipe`
- **Extends:** `open_ticket_ai.core.pipeline.BasePipe`
- **Category:** `ticket-system`
- **Module:** `open_ticket_ai.base.ticket_system_pipes.add_note_pipe`
- **Source:** `src/open_ticket_ai/open_ticket_ai/base/ticket_system_pipes/add_note_pipe.py`
- **Sidecar:** `docs/man_structured/pipes/sidecar_pipe_schema.yml`

## Summary

Fügt einem Ticket eine Notiz/Artikel hinzu.

## Implementation

```python
class AddNotePipe(Pipe):
    def __init__(self, pipe_params: dict[str, Any]) -> None:
        super().__init__(pipe_params)
        pipe_config = AddNotePipeConfig(**pipe_params)
        registry = UnifiedRegistry.get_registry_instance()
        self.ticket_system: TicketSystemService = registry.get_instance(pipe_config.ticket_system_id)
        self.ticket_id = pipe_config.ticket_id

        if isinstance(pipe_config.note, dict):
            self.note = UnifiedNote.model_validate(pipe_config.note)
        elif isinstance(pipe_config.note, str):
            self.note = UnifiedNote(body=pipe_config.note)
        else:
            self.note = pipe_config.note

    async def _process(self) -> dict[str, Any]:
        await self.ticket_system.add_note(self.ticket_id, self.note)
        return {}
```

## Configuration

**Config model:** `RawTicketSystemBasePipeConfig`

### Parameters

| Name | Description |
| --- | --- |
| `ticket_id` | Ticket-ID |
| `body` | Notiztext |
| `visibility` | internal|public _(default: `internal`)_ |

## Output

- **States:** `ok, skipped, failed`
- **Description:** Pipe liefert einen Status und optional Payload.
- **Payload schema:** `OpenTicketAI.Pipes.AddNote.Result`

### Output examples

#### Ok
```yaml
state: ok
payload:
  article_id: 12345
```

#### Skipped
```yaml
state: skipped
payload:
  reason: visibility_not_supported
```

#### Failed
```yaml
state: failed
error: ticket_not_found
```

## Error handling

### Fail

- `ticket_not_found` — Ticket-ID existiert nicht
- `backend_unauthorized` — Adapter kann nicht authentifizieren

### Break

- `config_invalid` — Erforderliche Konfiguration fehlt oder falscher Typ

### Continue

- `empty_body` — Body leer → Pipe überspringt
- `visibility_not_supported` — Adapter ignoriert nicht unterstützte Sichtbarkeit → skip

## Usage examples

### Minimal
```yaml
use: open_ticket_ai.basic_pipes.ticket_system_pipes.AddNotePipe
config:
  ticket_system: otobo_znuny
```

### Full
```yaml
use: open_ticket_ai.basic_pipes.ticket_system_pipes.AddNotePipe
when: true
config:
  ticket_system: otobo_znuny
with:
  ticket_id: '202501231234'
  body: 'Investigating'
  visibility: internal
```

### Large
```yaml
use: open_ticket_ai.basic_pipes.ticket_system_pipes.AddNotePipe
when: ${ env.PIPE_ADD_NOTE_ENABLED }
config:
  ticket_system: otobo_znuny
with:
  ticket_id: ${ context.last_created_ticket_id }
  body: |
    Root cause: database connection pool exhaustion
    Action: scaling pool to 50; adding slow query log
  visibility: public
```

## Orchestrations

### Basic Routing With Notes
```yaml
orchestrator:
  - use: ...FetchTicketPipe
  - use: open_ticket_ai.basic_pipes.ticket_system_pipes.AddNotePipe
    with:
      ticket_id: ${ context.ticket.id }
      body: 'Auto-routed to L2'
      visibility: internal
  - use: ...RouteTicketPipe
```

### Post-Classification Feedback
File reference: `examples/orchestrations/post_classification.yml`

## Notes

- Sichtbarkeit muss vom Backend-Adapter unterstützt werden.

## Related pipes

- `RouteTicketPipe`
- `UpdateTicketPipe`
