@startuml Pipeline Flow Diagram

!theme plain
skinparam activity {
    BackgroundColor lightblue
    BorderColor black
    FontSize 11
}
skinparam note {
    BackgroundColor lightyellow
    BorderColor orange
}

title Pipeline Execution Flow

start

:Load Config (config.yml);
note right: RawOpenTicketAIConfig\nparses orchestrator steps

:Initialize Context;
note right: Context(pipes={}, config={})

:Boot Injector & PipeFactory;
note right: Binds RawOpenTicketAIConfig,\nUnifiedRegistry, PipeFactory

partition "Pipeline Loop" {
    :Normalize pipeline entry\ninto RegisterableConfig;
    note right: Fields -> uid, id, use, injects

    :Render config via TemplateRenderer;
    note right: Scope merges env + context + defs

    :PipeFactory creates Pipe instance;
    note right: Resolves injects and\ninstantiates class from `use`

    partition "Pipe Processing" {
        :Check `_if` and dependencies;

        if (Runnable?) then (yes)
            if (Composite pipe?) then (yes)
                partition "Composite Step Loop" {
                    :Iterate rendered `steps`;
                    :PipeFactory builds child pipe;
                    :Execute child.process(context);
                    :Collect PipeResult;
                }
                :Union child results into PipeResult;
            else (no)
                :Execute pipe._process();
                :Wrap output as PipeResult;
            endif

            :Persist PipeResult to context;
            note right: context.pipes[config.id] = result
        else (no)
            :Skip pipe;
        endif
    }

    :Update context snapshot;

    if (More entries?) then (yes)
        :Continue orchestration;
    else (no)
        :Orchestration complete;
    endif
}

:Final Context State;
note right: Contains PipeResult\nfor each executed pipe

stop

note bottom
**Key Components:**
- **Context**: Carries shared PipeResult state and pipeline config
- **Pipe & CompositePipe**: Base execution units and step orchestrator
- **RegisterableConfig**: Normalised control fields for each pipeline entry
- **TemplateRenderer**: Renders configs before instantiation
- **PipeFactory**: Creates pipes and resolves `injects`
- **PipeResult**: Canonical outcome stored in the context
end note

@enduml
