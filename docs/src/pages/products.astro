---
import BaseLayout from '../layouts/BaseLayout.astro';
import Badge from '../components/vue/Badge.vue';
import { getCollection } from 'astro:content';

const title = "Our Technology Stack";

// Fetch all products from the content collection
const allProducts = await getCollection('products');

// Sort products by navigation order
const products = allProducts
  .filter(product => !product.data.nav?.hidden)
  .sort((a, b) => (a.data.nav?.order ?? 999) - (b.data.nav?.order ?? 999));

// Helper function to determine badge based on product slug
function getProductBadges(slug: string) {
  const badges: Array<{ label: string; color: string }> = [];
  
  if (slug === 'tagging-ai') {
    badges.push({ label: 'Coming Soon', color: 'bg-primary/20 text-primary-light border-primary/20' });
    badges.push({ label: 'On-Prem / Private Cloud', color: 'bg-slate-800/80 text-slate-300 border-slate-700/50' });
    badges.push({ label: 'Multilingual', color: 'bg-slate-800/80 text-slate-300 border-slate-700/50' });
  } else if (slug === 'synthetic-data-generator') {
    badges.push({ label: 'In Development', color: 'bg-pink-500/10 text-pink-400 border-pink-500/20' });
  }
  
  return badges;
}

// Helper function to get badge styles
function getBadgeStyles(label: string) {
  const isPink = label === 'In Development';
  return {
    backgroundColor: isPink ? 'rgba(236, 72, 153, 0.1)' : 'rgba(100, 108, 255, 0.1)',
    borderColor: isPink ? 'rgba(236, 72, 153, 0.2)' : 'rgba(100, 108, 255, 0.2)',
    color: isPink ? 'rgb(244, 114, 182)' : 'rgb(165, 180, 252)'
  };
}

// Helper function to get placeholder image based on index
function getPlaceholderImage(index: number) {
  const images = [
    'https://picsum.photos/1000/1000?blur=5',
    'https://picsum.photos/800/400',
    'https://picsum.photos/600/300'
  ];
  return images[index % images.length];
}

// Separate hero and regular products
const [heroProduct, ...regularProducts] = products;
---

<BaseLayout title={title} description={`${title} - Open Ticket AI`}>
  <div slot="head" />

  <div class="min-h-screen bg-background-dark py-24">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-20 text-center lg:text-left">
        <h1 class="font-display text-5xl md:text-7xl font-black text-white glow-text mb-8">Our Technology Stack</h1>
        <p class="text-xl text-text-dim max-w-2xl leading-relaxed">
          Secure, On-Premise AI for Enterprise Helpdesks built with German Engineering precision. Designed for strict data privacy and seamless integration.
        </p>
      </div>

      <div class="grid gap-8">
        {/* Hero Card - First Product */}
        {heroProduct && (() => {
          const badges = getProductBadges(heroProduct.data.slug);
          const placeholderImage = getPlaceholderImage(0);
          
          return (
            <div class="group relative flex flex-col overflow-hidden rounded-3xl bg-surface-dark border border-surface-lighter transition-all duration-500 hover:border-primary/50">
              <div class="absolute -top-32 -right-32 h-96 w-96 rounded-full bg-primary/10 blur-[120px]"></div>
              <div class="flex flex-col lg:flex-row items-stretch min-h-[500px]">
                <div class="flex flex-1 flex-col justify-center gap-8 p-12 lg:p-16 relative z-10">
                  {badges.length > 0 && (
                    <div class="flex flex-wrap gap-3">
                      {badges.map(badge => (
                        <Badge label={badge.label} color={badge.color} client:load />
                      ))}
                    </div>
                  )}
                  <div>
                    <h2 class="text-white text-5xl font-bold tracking-tight mb-4">{heroProduct.data.title}</h2>
                    <p class="text-text-dim text-xl leading-relaxed max-w-xl">
                      {heroProduct.data.description}
                    </p>
                  </div>
                  <div class="flex items-center gap-6 pt-4">
                    <button class="flex items-center justify-center rounded-xl h-14 px-10 bg-primary text-white text-lg font-bold hover:bg-white hover:text-background-dark transition-all shadow-xl shadow-primary/20">
                      Join Waitlist
                    </button>
                    <button class="flex items-center justify-center rounded-xl h-14 px-10 bg-transparent border border-surface-lighter hover:border-primary/50 text-white text-lg font-medium transition-all">
                      Technical Specs
                    </button>
                  </div>
                </div>
                <div class="relative w-full lg:w-[45%] min-h-[400px] bg-[#0c0d15] border-l border-surface-lighter">
                  <img
                    src={placeholderImage}
                    alt={heroProduct.data.title}
                    class="absolute inset-0 w-full h-full object-cover opacity-30 mix-blend-screen"
                  />
                  <div class="absolute inset-0 bg-gradient-to-l from-surface-dark via-transparent to-transparent"></div>
                </div>
              </div>
            </div>
          );
        })()}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {regularProducts.map((product, index) => {
            const badges = getProductBadges(product.data.slug);
            const placeholderImage = getPlaceholderImage(index + 1);
            const hasIcon = product.data.slug === 'open-ticket-automation-core';
            
            return (
              <div class="flex flex-col justify-between overflow-hidden rounded-3xl bg-surface-dark border border-surface-lighter p-10 hover:border-primary/30 transition-all">
                <div class="flex flex-col gap-6 mb-10">
                  {badges.length > 0 && (
                    <div class="flex flex-wrap gap-3">
                      {badges.map(badge => {
                        const styles = getBadgeStyles(badge.label);
                        return (
                          <div class="w-fit rounded-lg px-3 py-1 border" style={`background-color: ${styles.backgroundColor}; border-color: ${styles.borderColor}`}>
                            <p class="text-xs font-bold uppercase tracking-widest" style={`color: ${styles.color}`}>{badge.label}</p>
                          </div>
                        );
                      })}
                    </div>
                  )}
                  {hasIcon ? (
                    <div class="flex items-center gap-4">
                      <span class="material-symbols-outlined text-primary text-4xl">hub</span>
                      <h3 class="text-white text-3xl font-bold tracking-tight">{product.data.title}</h3>
                    </div>
                  ) : (
                    <h3 class="text-white text-3xl font-bold tracking-tight">{product.data.title}</h3>
                  )}
                  <p class="text-text-dim text-lg leading-relaxed">
                    {product.data.description}
                  </p>
                </div>
                <div class="w-full aspect-video rounded-2xl bg-[#0c0d15] overflow-hidden relative border border-white/5 mb-8">
                  <img src={placeholderImage} class="w-full h-full object-cover opacity-40" alt={product.data.title} />
                </div>
                <button class="group flex w-full items-center justify-between rounded-xl h-12 px-6 bg-transparent border border-border-dark hover:border-primary/50 text-white font-bold transition-all">
                  Learn More
                  <span class="material-symbols-outlined transition-transform group-hover:translate-x-1">arrow_forward</span>
                </button>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
.glow-text {
  text-shadow: 0 0 20px rgba(100, 108, 255, 0.3);
}
</style>
