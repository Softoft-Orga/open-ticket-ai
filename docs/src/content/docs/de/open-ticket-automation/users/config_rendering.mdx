---
title: Konfiguration & Template-Rendering
description: "Verstehen Sie den Konfigurationslebenszyklus von Open Ticket AI, das Template-Rendering mit Jinja2, Dependency Injection und wie YAML in Laufzeitobjekte transformiert wird."
---

# Konfiguration & Template-Rendering

Open Ticket AI ermöglicht es Ihnen, dynamische Konfigurationen mit **YAML** plus **Jinja2-Template-Ausdrücken** wie

<div class="pre">
  <code>{`{{ ... }}`}</code> ohne Leerzeichen
</div>
zu erstellen. Dies erlaubt es Ihnen, Werte wiederzuverwenden, Umgebungsvariablen auszulesen und Ergebnisse anderer Pipes zu referenzieren – und dabei die Konfiguration sauber und deklarativ zu halten.

## Schlüsselkonzepte

# Injectable Configuration Structure

Sowohl **Services** als auch **Pipes** in Open Ticket AI verwenden die gleiche Konfigurationsstruktur namens `InjectableConfig`. Das Verständnis dieser drei Kernattribute hilft Ihnen, jede Komponente im System zu konfigurieren.

## Konfigurationsattribute

| Attribut | Typ               | Beschreibung                                                                                           | Beispiel                            |
| -------- | ----------------- | ------------------------------------------------------------------------------------------------------ | ---------------------------------- |
| `use`    | `TEXT`            | Identifiziert, welche Komponente erstellt werden soll. Format: `plugin-name:ComponentName`             | `"base:FetchTicketsPipe"`          |
| `injects`| Name:Wert-Paare   | Ordnet Konstruktorparameternamen Service-IDs zu, um Abhängigkeiten mit dieser Komponente zu verbinden  | `{ ticket_system: "otobo_znuny" }` |
| `params` | Name:Wert-Paare   | Konfigurationsparameter, die spezifisch für diese Komponente sind. Jeder Komponententyp erwartet andere Parameter | `{ limit: 25, queue: "Support" }`  |

## Wichtige Unterschiede: Services vs. Pipes

Obwohl beide `InjectableConfig` verwenden, unterscheiden sie sich in der Verwendung:

### Services

- Einmalig im Abschnitt `services` definiert
- Wiederverwendbar über mehrere Pipes hinweg
- Müssen ein `id`-Feld zur Referenzierung haben
- Repräsentieren üblicherweise externe Systeme

**Beispiel:**

```yaml
services:
  otobo_znuny:
    use: 'otobo-znuny:OTOBOZnunyTicketSystemService'
    injects: {}
    params:
      base_url: 'https://helpdesk.example.com'
      password: "{{ get_env('OTOBO_PASSWORD') }}"
```

### Pipes

- Innerhalb der Pipeline-`steps` definiert
- Führen Aktionen sequenziell aus
- Haben ebenfalls ein `id`-Feld, um Ergebnisse zu referenzieren
- Nutzen Services via `injects`, um Arbeit zu verrichten

**Beispiel:**

```yaml
steps:
  - id: fetch_tickets
    use: 'base:FetchTicketsPipe'
    injects:
      ticket_system: 'otobo_znuny'
    params:
      ticket_search_criteria:
        limit: 25
```

## Template-Rendering

Alle Werte in `params` und `injects` unterstützen Jinja2-Templating für dynamische Konfiguration:

```yaml
params:
  api_key: "{{ get_env('API_KEY') }}"
  queue: "{{ get_pipe_result('classify', 'label') }}"
```

---

**Verwandt:
** [Template Rendering](../details/template_rendering.md) · [Dependency Injection](../developers/dependency_injection.md)

## Konfigurationsreferenz

Hier ist die Markdown-Tabelle, die die **vollständige Konfigurationsstruktur** sauber und bereit für Ihre Dokumentation beschreibt.

| Pfad                                        | Typ                              | Beschreibung                                                   | Beispiel                                       |                      |
| ------------------------------------------- | --------------------------------- | ------------------------------------------------------------- | --------------------------------------------- | -------------------- |
| `otai`                                      | `OpenTicketAIConfig`              | Hauptanwendungskonfigurationsstamm.                                 |                                               |                      |
| `otai.api_version`                          | `str`                             | API-Version für Kompatibilität.                                | `"1"`                                         |                      |
| `otai.plugins[]`                            | `list[str]`                       | Python-Modulpfade der zu ladenden Plugins.                       | `"otai_hf_local"`                             |                      |
| `otai.infrastructure`                       | `InfrastructureConfig`            | Infrastruktur-Level-Einstellungen.                                         |                                               |                      |
| `otai.infrastructure.logging`               | `LoggingConfig`                   | Logging-Konfiguration.                                        |                                               |                      |
| `otai.infrastructure.logging.level`         | `str`                             | Minimale Log-Level.                                                | `"INFO"`                                      |                      |
| `otai.infrastructure.logging.log_to_file`   | `bool`                            | Datei-Logging aktivieren.                                          | `false`                                       |                      |
| `otai.infrastructure.logging.log_file_path` | `str                              | None`                                                         | Log-Dateipfad, wenn aktiviert.                   | `"/var/log/app.log"` |
| `otai.infrastructure.logging.log_format`    | `str`                             | Python-Logging-Format-String.                                 | `"%(asctime)s - %(levelname)s - %(message)s"` |                      |
| `otai.infrastructure.logging.date_format`   | `str`                             | Datumsformat für Logs.                                         | `"%Y-%m-%d %H:%M:%S"`                         |                      |
| `otai.services`                             | `dict[str, InjectableConfigBase]` | Map von Service-ID → DI-Konfig.                                |                                               |                      |
| `otai.services.<id>`                        | `InjectableConfigBase`            | Eine Service-Definition.                                       |                                               |                      |
| `otai.services.<id>.use`                    | `str`                             | Python-Klassenpfad zum Instanziieren.                             | `"pkg.mod.Class"`                             |                      |
| `otai.services.<id>.injects`                | `dict[str,str]`                   | DI-Bindings: Konstruktor-Param → Service-ID.                         | `{ "db": "ticket-db" }`                       |                      |
| `otai.services.<id>.params`                 | `dict[str,Any]`                   | Konstruktorparameter (Templating erlaubt).                      | `{ "url": "{\{ get_env('DB_URL') }\}" }`      |                      |
| `otai.services.<id>.id`                     | `str`                             | Optionaler expliziter Bezeichner (bei Verwendung von `InjectableConfig`). | `"ticket-db"`                                 |                      |
| `otai.orchestrator`                         | `PipeConfig`                      | Orchestrator-Pipeline-Stamm.                                   |                                               |                      |
| `otai.orchestrator.id`                      | `str`                             | Pipe-Bezeichner (für Referenzierung). (geerbt)                 | `"root"`                                      |                      |
| `otai.orchestrator.use`                     | `str`                             | Python-Klassenpfad der Pipe. (geerbt)                     | `"project.pipes.CompositePipe"`               |                      |
| `otai.orchestrator.injects`                 | `dict[str,str]`                   | DI zu Sub-Pipes/Services. (geerbt)                          | `{ "step1": "ticket-db" }`                    |                      |
| `otai.orchestrator.params`                  | `dict[str,Any]`                   | Pipe-Parameter (Templating erlaubt). (geerbt)              | `{}`                                          |                      |

**Kleines Beispiel**

<div class="pre">

```yaml
otai:
  api_version: '1'
  plugins: []
  infrastructure:
    logging:
      level: 'INFO'
  services:
    ticket-db:
      use: 'plugin_name:Database'
      params:
        url: "{{ get_env('DB_URL') }}"
  orchestrator:
    id: 'root'
    use: 'base:CompositePipe'
    injects:
      step1: 'ticket-db'
    params: {}
```

</div>

## Verfügbare Hilfsfunktionen (für `config.yml`-Templates)

| Funktion           | Parameter                                          | Rückgabewert                                                          | Fehler, wenn…                    |
| ------------------ | --------------------------------------------------- | ---------------------------------------------------------------- | ----------------------------- |
| `at_path`          | `value: Any`, `path: text`                          | Verschachtelter Wert am Pfad `"a.b.c"`; unterstützt Dictionaries + Pydantic-Modelle | Ungültiges Pfadformat           |
| `has_failed`       | `pipe_id: text`                                     | `True`, wenn das gegebene Pipe-Ergebnis als fehlgeschlagen markiert ist                 | Unbekannte Pipe-ID               |
| `get_pipe_result`  | `pipe_id: text`, `data_key: text;default = "value"` | Wert, der im vorherigen Pipe-Ergebnis unter dem gegebenen `data_key` gespeichert ist      | Pipe oder Schlüssel fehlt           |
| `get_parent_param` | `param_key: text`                                   | Geerbter Elternparameterwert                                 | Eltern fehlt oder Schlüssel fehlt |
| `get_env`          | `name: text`                                        | Wert der Umgebungsvariable                                    | Env-Var fehlt               |
| `fail`             | _(keine)_                                            | Ein "FailMarker"-Sentinel-Objekt, um explizite Fehlerpfade zu signalisieren  | —                             |

---

## Verwendungsbeispiele in `config.yml`

### Eine Umgebungsvariable auslesen

```yaml
api:
  token: "{{ get_env('API_TOKEN') }}"
  baseUrl: 'https://api.example.com'
```

### Ein vorheriges Pipe-Ergebnis nutzen

```yaml
classification:
  label: "{{ get_pipe_result('classify_ticket', 'label') }}"
  confidence: "{{ get_pipe_result('classify_ticket', 'score') }}"
  isLowConfidence: "{{ get_pipe_result('classify_ticket', 'score') < 0.6 }}"
```

### Prüfen, ob eine Pipe fehlgeschlagen ist

```yaml
shouldRetry: "{{ has_failed('fetch_customer') }}"
```

### Einen Elternparameter auslesen

```yaml
timeoutMs: "{{ get_parent_param('timeoutMs') }}"
```

### Einen expliziten Fehlermarker ausgeben

```yaml
result: '{{ fail() }}'
```

### Auf verschachtelte Daten zugreifen (Dictionary oder Pydantic-Modell)

```yaml
userCity: "{{ at_path(user, 'address.city') }}"
```

## Vollständige Beispiele / Templates

Sehen Sie vollständige funktionierende Beispiele von config.yml

[Config Examples](../users/config_examples.mdx).