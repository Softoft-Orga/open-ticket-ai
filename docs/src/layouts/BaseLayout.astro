---
interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
const gaIds = ['AW-474755810', 'G-FBWC3JDZJ4'];
import NavBar from '../components/NavBar.astro';
import '../styles/global.css';
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <slot name="head" />

    <!-- Google Analytics lazy loading -->
    <script is:inline define:vars={{ gaIds }}>
      (() => {
        let loaded = false;
        function load() {
          if (loaded) return;
          loaded = true;
          const s = document.createElement('script');
          s.src = 'https://www.googletagmanager.com/gtag/js?id=' + gaIds[0];
          s.async = true;
          document.head.appendChild(s);
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gaIds.forEach((id) => {
            gtag('config', id, { send_page_view: false });
          });
        }
        if ('requestIdleCallback' in window) {
          requestIdleCallback(load, { timeout: 4000 });
        } else {
          setTimeout(load, 2000);
        }
        let fired = false;
        ['scroll', 'pointerdown', 'keydown', 'touchstart'].forEach((ev) => {
          addEventListener(
            ev,
            function () {
              if (fired) return;
              fired = true;
              load();
            },
            { passive: true, once: true }
          );
        });
      })();
    </script>
  </head>
  <body class="font-sans">
    <NavBar />
    <slot />
  </body>
</html>
