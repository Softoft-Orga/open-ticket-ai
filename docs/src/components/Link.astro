---
/**
 * Link component for locale-aware internal links
 * Automatically converts canonical hrefs to locale-aware URLs based on current locale
 */
import { localizeHref, getLocaleFromPath, type Locale } from '../lib/i18nLinks';

interface Props {
  href: string;
  class?: string;
  [key: string]: unknown;
}

const { href, class: className, ...rest } = Astro.props;

// Get current locale from URL
const currentLocale = getLocaleFromPath(Astro.url.pathname) as Locale;

// Ensure href has trailing slash if it's an internal path and doesn't have one
let normalizedHref = href;
if (href.startsWith('/') && !href.includes('#') && !href.endsWith('/')) {
  normalizedHref = href + '/';
}

// Localize the href
const localizedHref = localizeHref(normalizedHref, currentLocale);
---

<a href={localizedHref} class={className} {...rest}>
  <slot />
</a>
