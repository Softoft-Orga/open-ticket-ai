# Runner Definition Example
# This example demonstrates the new flexible trigger-based runner configuration

open_ticket_ai:
  plugins: []
  
  general_config:
    logging_level: INFO
  
  defs:
    # Reusable pipe definitions
    - &ticket_fetcher
      id: fetch-tickets
      use: open_ticket_ai.base:FetchTicketsPipe
      params:
        search_criteria:
          state.name: "new"
    
    - &ticket_classifier
      id: classify-tickets
      use: open_ticket_ai.base:ClassifyPipe
      params:
        model: "ticket-classifier-v1"
  
  orchestrator:
    runners:
      # Example 1: Simple interval-based runner
      - id: simple-poller
        triggers:
          - id: interval-10s
            use: apscheduler.triggers.interval:IntervalTrigger
            params:
              seconds: 10
        pipe:
          <<: *ticket_fetcher
      
      # Example 2: Runner with multiple triggers
      - id: multi-trigger-processor
        triggers:
          # Scheduled trigger
          - id: hourly-schedule
            use: apscheduler.triggers.interval:IntervalTrigger
            params:
              hours: 1
          # Cron-based trigger
          - id: business-hours-only
            use: apscheduler.triggers.cron:CronTrigger
            params:
              hour: "9-17"
              day_of_week: "mon-fri"
        pipe:
          id: composite-processor
          use: open_ticket_ai.base:CompositePipe
          steps:
            - <<: *ticket_fetcher
            - <<: *ticket_classifier
      
      # Example 3: Runner with concurrency and retry settings
      - id: high-throughput-processor
        triggers:
          - id: fast-interval
            use: apscheduler.triggers.interval:IntervalTrigger
            params:
              seconds: 5
        pipe:
          id: batch-processor
          use: open_ticket_ai.base:CompositePipe
          steps:
            - <<: *ticket_fetcher
            - <<: *ticket_classifier
        settings:
          concurrency:
            max_workers: 4
            when_exhausted: enqueue
          retry:
            attempts: 3
            delay: "5s"
            backoff_factor: 2.0
            max_delay: "30s"
            jitter: true
          timeout: "2m"
          priority: 5
          tags: ["batch", "high-priority"]
      
      # Example 4: Date-based trigger
      - id: monthly-report
        triggers:
          - id: first-of-month
            use: apscheduler.triggers.cron:CronTrigger
            params:
              day: 1
              hour: 0
              minute: 0
        pipe:
          id: generate-report
          use: open_ticket_ai.base:ReportPipe
          params:
            report_type: "monthly"
        settings:
          timeout: "10m"
          retry:
            attempts: 2
          tags: ["reporting", "monthly"]
      
      # Example 5: Legacy format (backward compatibility)
      # This will be automatically migrated to the new format
      - run_every_milli_seconds: 30000
        pipe:
          id: legacy-processor
          use: open_ticket_ai.base:FetchTicketsPipe
